# LangChain Hub 5.ipynb 실습 중 `Chain of Density (한국어)` 

## 실습 배경
- **날짜**: 2025-08-14
- **배경**: 처리 속도와 언어별 최적화 및 문장의 밀도에 대한 궁금증

## **처리 속도 차이의 근본 원인: 토큰화(Tokenization)**

  * **초기 관찰**: 동일한 분량의 한국어와 영어 기사를 처리했을 때, **영어가 한국어보다 더 빠른 처리 속도** 를 보임
  * **원인**:
      * **영어**: 단어(Word) 단위로 띄어쓰기가 명확하여 토큰화가 효율적. 한 단어가 하나의 토큰으로 처리되는 경우가 많음
      * **한국어**: 띄어쓰기가 있지만, 음절이나 형태소 단위로 쪼개져 토큰화. `안녕하세요` 같은 한 단어도 여러 토큰으로 분해될 수 있어, 텍스트 분량 대비 토큰 수가 많아 처리 시간이 더 오래 걸림

## **예상치 못한 결과: 언어별 최적화와 문장의 밀도**

### **언어별 최적화**

  * **관찰**: 한국어보다 토큰화가 복잡한 것으로 알려진 스페인어와 일본어가 예상보다 빠른 처리 속도를 보임
  * **분석**:
      * 이는 단순히 토큰 수만으로는 설명할 수 없으며, 모델의 **언어별 최적화** 수준이 반영된 결과
      * 최신 모델들은 다양한 언어에 대한 토큰화 및 처리 효율을 높이도록 최적화되어 있어, 복잡한 언어라도 효율적으로 처리 가능함을 알게 됨
      * 또한 **문장의 밀도** 역시 영향을 미침을 알고, 이를 높여 테스트함

### **문장의 '밀도'가 미치는 영향**

  * **관찰**: 분량이 비슷한 두 중국어 기사 중, **정보의 밀도와 문장 구조가 더 복잡한 기사** 가 훨씬 더 오래 걸림
  * **분석**:
      * 모델은 단순한 토큰화 과정을 넘어, 문장이 담고 있는 **복합적인 개념** 과 **논리적 관계** 를 파악하는 데 더 많은 연산 자원을 사용
      * 두 번째 중국어 기사는 `스마트시티`라는 큰 주제 아래 여러 하위 주제(교통, 환경, 문제점, 미래 비전)를 촘촘하게 연결하여 정보 밀도가 높음

## **프롬프트 지시와 모델의 언어별 해석 차이**

  * **상황**: `chain-of-density-korean` 프롬프트에 `Use only KOREAN language to reply.`라는 지시가 포함됨

  * **결과**:

      * **아랍어 기사**: `Missing_Entities`가 **한국어로 번역**되어 출력됨
          * **원인**: 
            * 아랍어의 복잡한 형태론적 특징으로 인해 모델이 `형태소` 단위로 분석하는 과정에서 한국어와 비슷한 `의미 단위`를 효과적으로 추출 및 번역
            * 프롬프트 지시에 **더욱 충실** 하게 응답한 것으로 보임
  
      * **태국어 기사**: `Missing_Entities`가 **원어(태국어)** 그대로 출력됨
          * **원인**: 
            * 태국어의 `띄어쓰기가 없는 특성` 
            * 모델이 단어 경계를 끊는 것보다 `원문을 그대로 가져오는 것`이 더 효율적이라고 판단했을 가능성이 높음

  * **결론**: 모델은 `프롬프트 지시`를 `언어의 특성에 따라 다르게 해석`할 수 있으며, 이로 인해 아랍어와 태국어처럼 다른 언어에서 서로 다른 결과가 나올 수 있음

## **효과적인 프롬프트 설계 제안**

>
> 이러한 문제점을 해결하고 모델의 응답을 더 정교하게 제어하기 위해, 프롬프트에 구체적인 지시를 추가하여 다음과 같은 방식으로 결과를 유도할 수 있을 것으로 예상
>

    ```json
    [
    {
        "Missing_Entities_Original": "ภาวะโลกร้อน; ผลกระทบต่ออุตสาหกรรมการท่องเที่ยว; การท่องเที่ยวเชิงอนุรักษ์",
        "Missing_Entities_Korean": "지구 온난화; 관광 산업에 미치는 영향; 지속 가능한 관광",
        "Denser_Summary": "..."
    },
    ...
    ]
    ```

  * **프롬프트 지시 수정 예시**:
      * `Step 1. Identify 1-3 informative entities...` 부분에 다음과 같은 내용을 추가
      * `Extract the entities from the original article text, and then provide a separate Korean translation for each.`
      * `If it is not possible to extract or translate the entities, state so in the corresponding field.`

  * **결과물의 명확성**
    * 원어와 한국어 번역본을 모두 요구 → 모델이 어떤 언어로 핵심 엔티티를 추출했는지 명확하게 확인할 수 있음
    * 이는 모델의 언어 처리 과정을 더 투명하게 보여줄 수 있음

  * **유연성**: 
    * 만약 모델이 `특정 언어(예: 태국어)`의 엔티티를 한국어로 번역하는 데 어려움을 겪는 경우
    * `추출이 어렵다`는 메시지 출력 → `무리하게 번역을 시도하는 대신 정확한 상태`를 알려줄 수 있음 
    * 이는 불필요한 오류나 잘못된 정보 생성을 방지할 수 있음

  * **안정성**: 
    * 아랍어처럼 원문 엔티티와 한국어 엔티티를 모두 잘 생성하는 언어의 경우, 두 정보를 모두 받아 신뢰도를 높일 수 있음

  * **정보의 풍부함**: 
    * 원어 엔티티는 원문의 뉘앙스를 유지하고, 한국어 번역본은 내용을 쉽게 이해하는 데 도움을 줍

>
> 이렇게 프롬프트를 구체화하면, 모델의 언어별 특성에 관계없이 일관성 있고 신뢰할 수 있는 결과물을 얻을 수 있을 것으로 예상함
> 