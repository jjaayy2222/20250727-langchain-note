# 🛠️ OutputParser / `Datetime` Troubleshooting 기록

> 작성일: 2025-08-25  
> 작성자: Jay  
---

## 1. `gemini-2.5` 모델의 `Datetime` Parser 처리 이슈

* **현재 날짜 출력** 묻는 프롬프트에 무조건 **`2024-05-15`** 으로 답하는 현상

### 1) **문제**: LLM이 현재 시간 요청 시 고정된 날짜 (2024-05-15) 반환

* `output2`의 첫 프롬프트: `대한민국의 현재 날짜는?`
  * 구체적인 장소를 제공하여 현재 날짜를 출력할 것으로 기대
  * `but` → 출력값: `2024-05-15`
  
* `두번째 시도`: `현재 날짜는?` or `오늘 날짜는?`
  * `현재`, `오늘` 이라는 단어를 통해 현재 날짜를 알 수 있을 것으로 기대
  * `but` → 출력값: `2024-05-15`
  
* `세번째 시도`: `LLM`이 학습된 데이터의 일부가 `특정 기준 날짜를 가지고 있을 수 있을 가능성`
  * 즉, **`2024-05-25`가 기본 설정값** 으로 설정된 경우일 가능성
  * 기본값을 무시하도록 프롬프트 수정 
    * `기본 날짜 설정을 무시하고, 오늘 날짜를 알려주세요.`
    * `오늘 날짜를 시스템 시간에 맞게 출력해주세요.`
  * **여전히 `2024-05-15`로 출력**

### 2) **원인**: Gemini 모델의 실시간 시스템 시간 접근 제한

* `gemini-2.5-flash-lite` = **모델 자체에 실시간 시스템 시간에 접근할 수 있는 제한이 없을 것으로 추측**
  * 추측 이유
    * 이유_1: **모델의 시간 처리 방식**
      * `Gemini-2.5-Flash-light` 모델 = 학습된 데이터에 기반하여 응답을 생성
      * 실시간 날짜 정보를 사용할 수 없거나 시스템 시간에 접근할 수 없을 수 있음
  
    * 이유_2: **프롬프트 자체에 시스템 시간 요청이 불가능**
      * `LLM`이 **훈련된 데이터와 규칙을 바탕으로 작동**
      * 따라서 실시간 시스템 시간을 모델에 직접 반영하는 것은 일반적인 사용 방식에서는 불가능할 수 있음

### 3) **해결**: Python datetime.now()로 시스템 시간을 프롬프트에 주입

  * 해결방법
    * 해결방법_1: `Python 코드`를 사용하여 시스템 날짜를 가져오기
      * `Python 코드`로 `시스템 날짜`를 동적으로 가져오고, 그 값을 프롬프트에 넣어서 모델을 호출하기
      * **성공!**

        ```python
            # 시스템 시간을 코드에서 가져와 프롬프트에 전달하기
            import datetime

            current_date = datetime.datetime.now().strftime("%Y-5m-%d")

            # 프롬프트로 만들기
            df_datetime = f"오늘 날짜는 {current_date}입니다."

            # 체인 실행하기
            output3 = chain_datetime.invoke({"question":df_datetime})

            # 결과 출력해보기 '
            print(output3.strftime("%Y-%m-%d"))                         # 2025-05-25 (0.7s)
        ```


    * 해결방법_2: 실시간 시간에 접근 가능한 `LLM`모델 사용하기
      * `ChatGPT`의 **플러그인 및 `API` 기능을 통해 시간 관련 작업 처리 가능**
      * `Google PaLM` 
        * `Google Cloud의 AI API` 
        * `PaLM` 모델 = 실시간 API 호출, 외부 데이터 소스에 통합해 시스템 시간 사용하는 APP 구축 가능
      * `Claude`: 시간, 날짜에 대한 문제를 해결할 수 있는 API 제공


### 4) **교훈**: LLM의 한계를 이해하고 외부 도구로 보완하는 하이브리드 접근의 필요성을 알게 됨